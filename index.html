<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Taco Promo Flip â€” El Chiflido</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <meta name="description" content="Encuentra el taco ganador y reclama tu premio por WhatsApp." />

  <style>
    .flip-scene { perspective: 1000px; }
    .flip-inner { transform-style: preserve-3d; transition: transform 600ms cubic-bezier(0.22,1,0.36,1); width: 100%; height: 100%; }
    .flip-front, .flip-back { position: absolute; inset: 0; backface-visibility: hidden; }
    .is-flipped .flip-inner { transform: rotateY(180deg); }
    .flip-back { transform: rotateY(180deg); }
    @keyframes blinkSoft { 0%{opacity:1} 50%{opacity:.35} 100%{opacity:1} } .blink-soft { animation: blinkSoft 1.1s infinite; }
    .confetti-layer { pointer-events:none; position:absolute; inset:0; overflow:hidden; }
    .confetti-dot { position:absolute; left:50%; top:45%; width:8px; height:8px; border-radius:9999px; background:white; opacity:0; transform: translate(-50%, -50%); }
    @keyframes confettiFall { 0%{opacity:0; transform: translate(0,0) rotate(0deg) scale(.9);} 10%{opacity:1;} 100%{opacity:0; transform: translate(var(--dx), calc(var(--dy) + 400px)) rotate(var(--rot)) scale(1);} }
  </style>
</head>
<body style="padding-bottom: max(env(safe-area-inset-bottom), 12px);" class="min-h-screen w-full bg-amber-300 text-neutral-900 flex items-start justify-center p-4 relative overflow-x-hidden">

  <audio id="win-audio" preload="auto">
    <source src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg" type="audio/ogg" />
    <source src="https://cdn.pixabay.com/download/audio/2022/03/10/audio_3b8a6af1cf.mp3?filename=success-1-6297.mp3" type="audio/mpeg" />
  </audio>

  <div class="w-full max-w-5xl relative z-10">
    <header class="mb-6 flex flex-col items-center text-center gap-4">
      <img class="h-14 object-contain drop-shadow" src="https://cracks.agency/wp-content/uploads/2025/03/logo-chiflido.png" alt="El Chiflido" />
      <div>
        <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight">TACO PROMO FLIP</h1>
        <p class="text-neutral-800/90 text-base sm:text-lg">Encuentra el taco ganador y desbloquea la promo ðŸŽ‰</p>
      </div>

      <button id="btn-reset" class="px-6 py-3 rounded-2xl bg-neutral-900/10 hover:bg-neutral-900/15 active:scale-95 transition border border-neutral-900/20 text-base">
        Reiniciar
      </button>

      <!-- Socials con SVG correctos -->
      <div class="flex gap-4 mt-2 text-xl text-neutral-900">
        <a class="hover:scale-110 transition" href="https://www.instagram.com/elchiflido_mx/" target="_blank" rel="noopener noreferrer" aria-label="Instagram">
          <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none">
            <rect x="2" y="2" width="20" height="20" rx="5" stroke="currentColor" stroke-width="1.6"/>
            <circle cx="12" cy="12" r="4.2" stroke="currentColor" stroke-width="1.6"/>
            <circle cx="17.5" cy="6.5" r="1.2" fill="currentColor"/>
          </svg>
        </a>
        <a class="hover:scale-110 transition" href="https://www.tiktok.com/@elchiflido_mx" target="_blank" rel="noopener noreferrer" aria-label="TikTok"><img src="https://cdn.simpleicons.org/tiktok" alt="TikTok" width="26" height="26" style="display:block" /></a>
        <a class="hover:scale-110 transition" href="https://www.facebook.com/elchiflldomx" target="_blank" rel="noopener noreferrer" aria-label="Facebook">
          <svg xmlns="http://www.w3.org/2000/svg" width="26" height="26" viewBox="0 0 24 24" fill="none">
            <path d="M13.5 9H15V6h-1.5C11.6 6 11 7.5 11 9.3V11H9v3h2v6h3v-6h2.1l.4-3H14v-1.3c0-.5.4-.7.9-.7H15z" fill="currentColor"/>
            <rect x="2" y="2" width="20" height="20" rx="4" stroke="currentColor" stroke-width="1.2"/>
          </svg>
        </a>
      </div>
    </header>

    <section class="mb-6 grid grid-cols-2 sm:grid-cols-3 gap-3">
      <div class="rounded-2xl bg-white/60 border border-amber-700/20 p-4 shadow">
        <p class="text-neutral-700 text-xs">Intentos fallidos</p>
        <p id="misses" class="text-lg font-semibold">0</p>
      </div>
      <div class="rounded-2xl bg-white/60 border border-amber-700/20 p-4 shadow">
        <p class="text-neutral-700 text-xs">Promos ocultas</p>
        <p class="text-lg font-semibold">1</p>
      </div>
      <div class="rounded-2xl bg-white/60 border border-amber-700/20 p-4 col-span-2 sm:col-span-1 shadow">
        <p class="text-neutral-700 text-xs">Estado</p>
        <p id="status" class="text-lg font-semibold"><span class="blink-soft">Buscandoâ€¦</span></p>
      </div>
    </section>

    <main id="grid" class="grid grid-cols-2 gap-2 sm:grid-cols-3 sm:gap-4 md:gap-6"></main>

    <div id="win-panel" class="hidden mt-8 text-center relative">
      <div id="confetti" class="confetti-layer"></div>

      <div class="mx-auto max-w-2xl flex flex-col items-center gap-3 px-5 py-4 rounded-2xl bg-white/70 border border-amber-600/40 backdrop-blur shadow">
        <div class="text-6xl">ðŸŽ‰</div>
        <div class="font-extrabold leading-tight text-3xl sm:text-5xl text-amber-900">
          Â¡Ganaste un taco de carnita!
        </div>

        <div class="w-full mt-1">
          <div class="mx-auto max-w-md px-3 py-2 rounded-xl bg-amber-500/15 border border-amber-700/30 text-amber-900 font-bold text-sm sm:text-base leading-snug">
            SÃ© honesto, Â¿cuÃ¡ntos clicks te ha llevado desbloquear esta promociÃ³n?
          </div>
        </div>

        <a id="wa-btn" target="_blank" rel="noopener noreferrer"
           class="mt-1 px-5 py-2 rounded-xl bg-green-600 text-white hover:bg-green-700 active:scale-95 transition shadow">
          Reclama tu premio
        </a>

        <div id="code-block" class="hidden w-full mt-2">
          <div class="text-sm text-neutral-700">Con este cÃ³digo acÃ©rcate a El Chiflido y reclama tu premio:</div>
          <div id="win-code" class="mt-2 select-all mx-auto inline-flex items-center gap-2 px-4 py-2 rounded-xl bg-amber-100 border border-amber-700/30 font-mono text-xl tracking-widest"></div>
        </div>
      </div>

      <p class="mt-3 text-neutral-800/80 text-sm">(Pulsa Reiniciar para jugar otra vez.)</p>
    </div>
  </div>

  <script>
    const CARD_COUNT = 6;
    const WINNERS_COUNT = 1;
    const DEFAULT_TACO_EMOJI = "ðŸŒ®";
    const WHATSAPP_NUMBER = "593979342895";
    const WA_MESSAGE = encodeURIComponent("Vengo a reclamar el premio que me ganÃ© en el correo electrÃ³nico que enviaron.");
    const WA_HREF = `https://wa.me/${WHATSAPP_NUMBER}?text=${WA_MESSAGE}`;

    let winners = pickWinners(CARD_COUNT, WINNERS_COUNT);
    let flipped = Array(CARD_COUNT).fill(false);
    let misses = 0;
    let foundWin = false;

    const grid = document.getElementById("grid");
    const missesEl = document.getElementById("misses");
    const statusEl = document.getElementById("status");
    const winPanel = document.getElementById("win-panel");
    const confettiLayer = document.getElementById("confetti");
    const waBtn = document.getElementById("wa-btn");
    const winAudio = document.getElementById("win-audio");
    const btnReset = document.getElementById("btn-reset");
    const winCodeBox = document.getElementById("win-code");

    waBtn.href = WA_HREF;
    renderGrid();

    btnReset.addEventListener("click", resetGame);

    function pickWinners(cardCount, winnersCount) {
      const all = Array.from({ length: cardCount }, (_, i) => i);
      for (let i = all.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [all[i], all[j]] = [all[j], all[i]];
      }
      return new Set(all.slice(0, winnersCount));
    }

    function makeCode() {
      const chars = "ABCDEFGHJKLMNPQRSTUVWXYZ23456789";
      let s = "";
      for (let i = 0; i < 6; i++) s += chars[Math.floor(Math.random() * chars.length)];
      return `CARNITA-${s}`;
    }

    function resetGame() {
      winners = pickWinners(CARD_COUNT, WINNERS_COUNT);
      flipped = Array(CARD_COUNT).fill(false);
      misses = 0;
      foundWin = false;
      missesEl.textContent = String(misses);
      statusEl.innerHTML = '<span class="blink-soft">Buscandoâ€¦</span>';
      winPanel.classList.add("hidden");
      confettiLayer.innerHTML = "";
      renderGrid();
    }

    function renderGrid() {
      grid.innerHTML = "";
      for (let i = 0; i < CARD_COUNT; i++) {
        const btn = document.createElement("button");
        btn.setAttribute("aria-label", `Taco ${i + 1}`);
        btn.className = "relative w-full aspect-square select-none focus:outline-none flip-scene";

        const inner = document.createElement("div");
        inner.className = "flip-inner";

        const front = document.createElement("div");
        front.className = "flip-front absolute inset-0 rounded-3xl bg-white/70 border border-amber-700/30 flex items-center justify-center overflow-hidden shadow p-2";
        front.innerHTML = `<span class="text-3xl sm:text-6xl select-none">${DEFAULT_TACO_EMOJI}</span>`;

        const back = document.createElement("div");
        const isWin = winners.has(i);
        back.className = "flip-back absolute inset-0 rounded-3xl flex flex-col items-center justify-center gap-1 p-4 text-center border shadow overflow-hidden origin-center " + (isWin ? "bg-emerald-500/20 border-emerald-600/50" : "bg-white/70 border-amber-700/30");

        const icon = document.createElement("div");
        icon.className = "text-xl sm:text-4xl";
        icon.textContent = isWin ? "ðŸŽ‰" : "ðŸ™ƒ";

        const text = document.createElement("div");
        text.className = "font-extrabold text-amber-900 leading-tight break-words px-1";
        const mobile = document.createElement("span");
        mobile.className = "sm:hidden block";
        mobile.style.fontSize = "clamp(12px, 3.8vw, 16px)";
        mobile.textContent = isWin ? "Â¡Ganaste un taco de carnita!" : "Haz clic en otro taco.";

        const desktop = document.createElement("span");
        desktop.className = "hidden sm:inline text-base";
        desktop.textContent = isWin ? "Â¡Ganaste un taco de carnita!" : "Haz clic en otro taco.";

        text.appendChild(mobile);
        text.appendChild(desktop);

        const sub = document.createElement("div");
        sub.className = "font-medium";
        sub.innerHTML = isWin ? "" : "Sigue intentando";

        back.appendChild(icon);
        if (!isWin) back.appendChild(sub);
        back.appendChild(text);

        inner.appendChild(front);
        inner.appendChild(back);
        btn.appendChild(inner);

        btn.addEventListener("click", () => handleFlip(btn, i));
        grid.appendChild(btn);
      }
    }

    function handleFlip(btn, idx) {
      if (flipped[idx] || foundWin) return;
      flipped[idx] = true;
      btn.classList.add("is-flipped");

      if (winners.has(idx)) {
        foundWin = true;
        statusEl.textContent = "Â¡Ganaste!";
        showWinPanel();
        try { winAudio.currentTime = 0; winAudio.play(); } catch {}
      } else {
        misses += 1;
        missesEl.textContent = String(misses);
      }
    }

    function showWinPanel() {
      const code = makeCode();
      winCodeBox.textContent = code;
      winPanel.classList.remove("hidden");
      burstConfetti(90);
    }

    function burstConfetti(n) {
      confettiLayer.innerHTML = "";
      for (let i = 0; i < n; i++) {
        const dot = document.createElement("span");
        dot.className = "confetti-dot";
        const dx = (Math.random() - 0.5) * window.innerWidth + "px";
        const dy = (Math.random() - 0.5) * window.innerHeight + "px";
        const rot = Math.floor(Math.random() * 360) + "deg";
        const dur = 1 + Math.random() * 1.2;
        const delay = Math.random() * 0.3;
        dot.style.setProperty("--dx", dx);
        dot.style.setProperty("--dy", dy);
        dot.style.setProperty("--rot", rot);
        dot.style.animation = `confettiFall ${dur}s ease-out ${delay}s forwards`;
        confettiLayer.appendChild(dot);
      }
    }
  </script>
</body>
</html>
